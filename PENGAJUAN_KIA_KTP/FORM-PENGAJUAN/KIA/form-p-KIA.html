<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pengajuan KIA Disabilitas</title>
    <link
      href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css"
      rel="stylesheet"
    />
    <style>
      body {
        padding-top: rem; /* Sesuaikan dengan tinggi header Anda */
      }
    </style>
    <style>
      .dashboard-btn {
        display: flex;
        align-items: center;
      }

      .logout-container {
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: rgb(51, 1, 1);
        border-radius: 20px;
        padding: 7px;
        margin-right: 10px;
        margin-top: -7px;
      }

      .logout-icon {
        width: 25px;
        height: 25px;
        cursor: pointer;
      }

      .dashboard-link {
        display: flex;
        align-items: center;
        border: 1px solid rgb(0, 13, 31);
        color: black;
      }

      .dashboard-link:hover,
      .dashboard-link:focus {
        background-color: rgb(0, 13, 31);
        color: white;
        outline: none;
      }

      .dashboard-wrapper {
        display: flex;
        align-items: center;
      }

      .btn {
        display: inline-block;
        padding: 10px 20px;
        color: #fff;
        background-color: #007bff;
        text-decoration: none;
        border-radius: 5px;
      }
    </style>
  </head>

  <body class="bg-gray-100">
    <!-- Header -->
    <header class="bg-white border-gray-200 w-full fixed top-0 left-0 z-10">
      <nav
        class="max-w-screen-xl flex flex-wrap items-center justify-between mx-auto p-4"
      >
        <div class="flex flex-row items-center">
          <a
            href="#hero"
            class="flex items-center space-x-3 rtl:space-x-reverse"
          >
            <span
              class="self-center text-2xl font-semibold whitespace-nowrap uppercase"
              >logo</span
            >
          </a>
        </div>
        <div>
          <button
            data-collapse-toggle="navbar-default"
            type="button"
            class="inline-flex items-center p-2 w-10 h-10 justify-center text-sm text-gray-500 rounded-lg md:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200"
            aria-controls="navbar-default"
            aria-expanded="false"
          >
            <span class="sr-only">Open main menu</span>
            <svg
              class="w-5 h-5"
              aria-hidden="true"
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 17 14"
            >
              <path
                stroke="currentColor"
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M1 1h15M1 7h15M1 13h15"
              />
            </svg>
          </button>
        </div>
        <!-- desktop tablet -->
        <div
          class="w-full md:block md:w-auto relative hidden"
          id="navbar-default"
        >
          <ul
            class="font-medium flex flex-col p-4 md:p-0 mt-4 border border-gray-100 rounded-lg bg-gray-50 md:flex-row md:space-x-8 rtl:space-x-reverse md:mt-0 md:border-0 md:bg-white absolute md:static w-full md:w-auto md:translate-y-0 md:opacity-100 navbar-web transition-all"
          >
            <li>
              <a
                href="../../../index.html"
                class="block py-2 px-3 text-gray-900 rounded hover:bg-gray-100 md:hover:bg-transparent md:border-0 md:hover:text-blue-700 md:p-0"
                >Beranda</a
              >
            </li>
            <li>
              <a
                href="../../../pelayanan_data/DalamPembagungan.html"
                class="block py-2 px-3 text-gray-900 rounded hover:bg-gray-100 md:hover:bg-transparent md:border-0 md:hover:text-blue-700 md:p-0"
                >Pelayanan Data</a
              >
            </li>
            <li>
              <a
                href="../../../index.html#about-program"
                class="block py-2 px-3 text-gray-900 rounded hover:bg-gray-100 md:hover:bg-transparent md:border-0 md:hover:text-blue-700 md:p-0"
                >Informasi</a
              >
            </li>
            <li>
              <a
                href="../../../index.html#footer"
                class="block py-2 px-3 text-gray-900 rounded hover:bg-gray-100 md:hover:bg-transparent md:border-0 md:hover:text-blue-700 md:p-0"
                >Kontak</a
              >
            </li>
            <!-- mobile view -->
            <div class="mt-2">
              <div class="flex md:hidden flex-row pt-4">
                <a
                  href="../../../log-in/login.html"
                  id="loginBtn"
                  class="text-gray-900 bg-white focus:outline-none hover:bg-gray-100 focus:ring-4 focus:ring-gray-100 font-medium rounded-full text-sm px-5 py-2.5 me-2 mb-2"
                >
                  <div class="flex flex-row align-middle">
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      class="w-4"
                      viewBox="0 0 24 24"
                      id="person"
                    >
                      <path fill="none" d="M0 0h24v24H0V0z"></path>
                      <path
                        d="M12 5.9c1.16 0 2.1.94 2.1 2.1s-.94 2.1-2.1 2.1S9.9 9.16 9.9 8s.94-2.1 2.1-2.1m0 9c2.97 0 6.1 1.46 6.1 2.1v1.1H5.9V17c0-.64 3.13-2.1 6.1-2.1M12 4C9.79 4 8 5.79 8 8s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm0 9c-2.67 0-8 1.34-8 4v2c0 .55.45 1 1 1h14c.55 0 1-.45 1-1v-2c0-2.66-5.33-4-8-4z"
                      ></path>
                    </svg>
                    <span class="ml-1">Masuk</span>
                  </div>
                </a>
                <a
                  href="../../../sign-in/sign-in.html"
                  type="button"
                  class="text-gray-900 bg-white border border-gray-700 focus:outline-none hover:bg-gray-100 focus:ring-4 focus:ring-gray-100 font-medium rounded-full text-sm px-5 py-2.5 me-2 mb-2"
                  id="registerBtn"
                  >Daftar</a
                >
              </div>
            </div>
          </ul>
        </div>
        <!-- Desktop -->
        <div class="hidden md:flex flex-row pt-2">
          <a
            id="loginBtnDesktop"
            href="../../../log-in/login.html"
            type="button"
            class="text-gray-900 bg-white focus:outline-none hover:bg-gray-100 focus:ring-4 focus:ring-gray-100 font-medium rounded-full text-sm px-5 py-2.5 me-2 mb-2"
          >
            <div class="flex flex-row align-middle">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="w-4"
                viewBox="0 0 24 24"
                id="person"
              >
                <path fill="none" d="M0 0h24v24H0V0z"></path>
                <path
                  d="M12 5.9c1.16 0 2.1.94 2.1 2.1s-.94 2.1-2.1 2.1S9.9 9.16 9.9 8s.94-2.1 2.1-2.1m0 9c2.97 0 6.1 1.46 6.1 2.1v1.1H5.9V17c0-.64 3.13-2.1 6.1-2.1M12 4C9.79 4 8 5.79 8 8s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm0 9c-2.67 0-8 1.34-8 4v2c0 .55.45 1 1 1h14c.55 0 1-.45 1-1v-2c0-2.66-5.33-4-8-4z"
                ></path>
              </svg>
              <span class="ml-1">Masuk</span>
            </div>
          </a>
          <a
            id="registerBtnDesktop"
            href="../../../sign-in/sign-in.html"
            type="button"
            class="text-gray-900 bg-white border border-gray-700 focus:outline-none hover:bg-gray-100 focus:ring-4 focus:ring-gray-100 font-medium rounded-full text-sm px-5 py-2.5 me-2 mb-2"
            >Daftar</a
          >
        </div>
      </nav>
    </header>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const email = localStorage.getItem("email");
        if (email) {
          const loginBtn = document.getElementById("loginBtn");
          const registerBtn = document.getElementById("registerBtn");
          const loginBtnDesktop = document.getElementById("loginBtnDesktop");
          const registerBtnDesktop =
            document.getElementById("registerBtnDesktop");

          if (loginBtn && registerBtn) {
            loginBtn.parentNode.removeChild(loginBtn);
            registerBtn.parentNode.innerHTML = `
                      <div class="dashboard-wrapper">
                          <div class="logout-container">
                              <img src="/src/icon/logout.png" alt="Logout" class="logout-icon" id="logoutBtn">
                          </div>
                          <a href="../Dashboard/Dasboard.html" type="button" class="dashboard-link text-black font-medium rounded-full text-sm px-5 py-2.5">
                              Dashboard
                          </a>
                      </div>
                  `;
          }

          if (loginBtnDesktop && registerBtnDesktop) {
            loginBtnDesktop.parentNode.removeChild(loginBtnDesktop);
            registerBtnDesktop.parentNode.innerHTML = `
                      <div class="dashboard-wrapper">
                          <div class="logout-container">
                              <img src="/src/icon/logout.png" alt="Logout" class="logout-icon" id="logoutBtnDesktop">
                          </div>
                          <a href="../Dashboard/Dasboard.html" type="button" class="dashboard-link text-black font-medium rounded-full text-sm px-5 py-2.5">
                              Dashboard
                          </a>
                      </div>
                  `;
          }

          const logoutBtn = document.getElementById("logoutBtn");
          const logoutBtnDesktop = document.getElementById("logoutBtnDesktop");

          if (logoutBtn) {
            logoutBtn.addEventListener("click", function () {
              localStorage.clear();
              window.location.reload();
            });
          }

          if (logoutBtnDesktop) {
            logoutBtnDesktop.addEventListener("click", function () {
              localStorage.clear();
              window.location.reload();
            });
          }
        }
      });
    </script>
    <!-- Main Content -->
    <main class="pt-40 pb-10">
      <div class="bg-white p-6 rounded-lg shadow-lg mx-auto" style="max-width: 1000px;">
        <h1 class="text-3xl font-semibold mb-4">
          Formulir Pengajuan KIA Disabilitas
        </h1>
        <form id="kia-disabilitas-form">
          <label class="block mb-2">
            <span class="text-lg text-gray-700">Nama Lengkap</span>
            <input
              type="text"
              name="nama"
              class="mt-1 block w-full px-4 py-3 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"
              required
            />
          </label>
          <label class="block mb-2">
            <span class="text-lg text-gray-700">Tanggal Lahir</span>
            <input
              type="date"
              name="tanggal_lahir"
              class="mt-1 block w-full px-4 py-3 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"
              required
            />
          </label>
          <label class="block mb-2">
            <span class="text-lg text-gray-700">Alamat</span>
            <input
              type="text"
              name="alamat"
              class="mt-1 block w-full px-4 py-3 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"
              required
            />
          </label>
          <label class="block mb-2">
            <span class="text-lg text-gray-700">Jenis Disabilitas</span>
            <select
              name="jenis_disabilitas"
              class="mt-1 block w-full px-4 py-3 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"
              required
            >
              <option value="">Pilih Jenis Disabilitas</option>
              <option value="fisik">Disabilitas Fisik</option>
              <option value="sensorik">Disabilitas Sensorik</option>
              <option value="mental">Disabilitas Mental</option>
              <option value="intelektual">Disabilitas Intelektual</option>
              <option value="ganda">Disabilitas Ganda</option>
            </select>
          </label>
          <label class="block mb-2">
            <span class="text-lg text-gray-700">Unggah Surat Keterangan Disabilitas</span>
            <input
              type="file"
              name="berkas_disabilitas"
              class="mt-1 block w-full px-4 py-3 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"
              required
            />
          </label>
          <button
            type="submit"
            class="bg-blue-500 text-white px-5 py-3 rounded-md hover:bg-blue-600 text-lg"
          >
            Kirim Pengajuan
          </button>
        </form>
        <div id="messageContainer" class="mt-4"></div>
      </div>
    </main>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>
    <script>
      document
        .getElementById("kia-disabilitas-form")
        .addEventListener("submit", function (event) {
          event.preventDefault();
          // Handle form submission to Firebase
        });

      // Firebase configuration
      var firebaseConfig = {
        apiKey: "AIzaSyDYQ9CqFLGwHfJXUEYGZTocX2V_esEVDyw",
        authDomain: "websitedatabasetest.firebaseapp.com",
        projectId: "websitedatabasetest",
        storageBucket: "websitedatabasetest.appspot.com",
        messagingSenderId: "1066826882782",
        appId: "1:1066826882782:web:433a1038a8f4c5a36a2c4f",
        measurementId: "G-3DBL7775CX",
      };

      // Initialize Firebase
      firebase.initializeApp(firebaseConfig);
      var db = firebase.firestore();
      var storage = firebase.storage();

      // Form submission handler for KIA Disabilitas
      document
        .getElementById("kia-disabilitas-form")
        .addEventListener("submit", function (e) {
          e.preventDefault(); // Prevent default form submission

          // Fetch form values
          var nama = document.getElementsByName("nama")[0].value;
          var tanggalLahir =
            document.getElementsByName("tanggal_lahir")[0].value;
          var alamat = document.getElementsByName("alamat")[0].value;
          var jenisDisabilitas =
            document.getElementsByName("jenis_disabilitas")[0].value;
          var berkasDisabilitas =
            document.getElementsByName("berkas_disabilitas")[0].files[0];

          // Use the nama as the document ID (replace any non-alphanumeric characters)
          var applicationDocId = nama.replace(/[^a-zA-Z0-9]/g, "_");

          // Show uploading message
          showMessage("Sedang mengunggah, harap tunggu...");

          // Save data to Firestore under 'kiaDisabilitas'
          var applicationDocRef = db
            .collection("kiaDisabilitas")
            .doc(applicationDocId);

          applicationDocRef
            .set({
              nama: nama,
              tanggalLahir: tanggalLahir,
              alamat: alamat,
              jenisDisabilitas: jenisDisabilitas,
            })
            .then(function () {
              // Upload Surat Keterangan Disabilitas to Firebase Storage if provided
              if (berkasDisabilitas) {
                uploadBerkasDisabilitas(applicationDocId, berkasDisabilitas);
              } else {
                showMessage("Data berhasil disimpan.");
              }
            })
            .catch(function (error) {
              console.error("Error adding document: ", error);
              showMessage("Terjadi kesalahan saat menyimpan data.", true);
            });
        });

      // Function to upload Surat Keterangan Disabilitas to Firebase Storage
      function uploadBerkasDisabilitas(docId, berkasDisabilitas) {
        var storageRef = storage.ref();
        var fileName = `${docId}_BerkasDisabilitas.${berkasDisabilitas.name
          .split(".")
          .pop()}`;
        var uploadTask = storageRef
          .child("kia_disabilitas/" + fileName)
          .put(berkasDisabilitas);

        uploadTask.on(
          "state_changed",
          function (snapshot) {
            // Track upload progress (optional)
          },
          function (error) {
            console.error("Error uploading berkas disabilitas:", error);
            showMessage(
              "Terjadi kesalahan saat mengunggah berkas disabilitas.",
              true
            );
          },
          function () {
            showMessage("Berkas disabilitas berhasil diunggah.");
          }
        );
      }

      // Function to display messages to the user
      function showMessage(message, isError = false) {
        var messageContainer = document.getElementById("messageContainer");
        messageContainer.innerHTML = ""; // Mengosongkan pesan sebelumnya

        var messageElement = document.createElement("p");
        messageElement.textContent = message;
        messageElement.classList.remove("text-red-500", "text-green-500");

        if (isError) {
          messageElement.classList.add("text-red-500");
        } else {
          messageElement.classList.add("text-green-500");
        }

        messageContainer.appendChild(messageElement);
      }
    </script>
  </body>
</html>
